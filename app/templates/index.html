{% extends "base.html" %}
{% block title %}ğŸ’Š Medicinschema{% endblock %}

{% block content %}
  <h1>{{ profil.namn }}â€™s Medicinlogg</h1>
  <h2>ğŸ’Š Medicinschema â€“ bocka i dagens intag</h2>

  <form method="POST">
    {% for med in mediciner %}
      {% if senaste[med.namn] %}
        {% set timmar = ((datetime.now() - senaste[med.namn]).total_seconds() / 3600)|round(1) %}
        {% set klass = med.fÃ¤rgklass if timmar > med.grÃ¤ns_i_timmar else "" %}
      {% else %}
        {% set timmar = None %}
        {% set klass = "" %}
      {% endif %}

      <div class="medicin {{ klass }} {{ med.fÃ¤rgklass if klass else '' }}">
        <input type="checkbox" id="{{ med.namn }}" name="{{ med.namn }}">
        <label for="{{ med.namn }}">{{ med.namn }}</label>

        <div class="timestamp">
          {% if timmar is not none %}
            {% if timmar < 1 %}
              {% set minuter = ((datetime.now() - senaste[med.namn]).total_seconds() / 60)|round(0) %}
              Togs fÃ¶r {{ minuter }} minuter sedan
              <div class="recent-dose">Intaget nyligen</div>
            {% else %}
              {% set timmar_heltal = timmar|int %}
              {% set minuter = ((timmar - timmar_heltal) * 60)|round(0) %}
              Togs fÃ¶r {{ timmar_heltal }} timmar{% if minuter > 0 %} och {{ minuter }} minuter{% endif %} sedan
            {% endif %}

            {% if med.visa_nÃ¤sta_dos and timmar < med.grÃ¤ns_i_timmar %}
              {% set Ã¥terstÃ¥r = (med.grÃ¤ns_i_timmar - timmar)|round(1) %}
              <div class="next-dose">NÃ¤sta dos om ca {{ Ã¥terstÃ¥r }} timmar</div>
            {% endif %}
          {% else %}
            ğŸ”´ Ej registrerat intag
          {% endif %}
        </div>
      </div>
    {% endfor %}
    <button type="submit">âœ” Skicka in</button>
  </form>
{% endblock %}
