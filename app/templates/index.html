{% extends "base.html" %}
{% block title %}ğŸ’Š Medicinschema{% endblock %}

{% block content %}
  <h1>{{ profil.namn }}â€™s Medicinlogg</h1>
  <h2>ğŸ’Š Medicinschema â€“ bocka i dagens intag</h2>

  <form method="POST">
    {% for med in mediciner %}
      {% set grÃ¤ns = med.grÃ¤ns_i_timmar %}
      {% set senaste_tid = senaste[med.namn] if senaste[med.namn] else None %}

      {% if senaste_tid %}
        {% set timmar = ((datetime.now() - senaste_tid).total_seconds() / 3600)|round(1) %}
      {% else %}
        {% set timmar = None %}
      {% endif %}

      {% if grÃ¤ns and grÃ¤ns > 0 and timmar and timmar > grÃ¤ns %}
        {% set klass = med.fÃ¤rgklass %}
      {% else %}
        {% set klass = "" %}
      {% endif %}

      <div class="medicin {{ klass }} {{ med.fÃ¤rgklass if klass else '' }}">
        <input type="checkbox" id="{{ med.namn }}" name="{{ med.namn }}">
        <label for="{{ med.namn }}">{{ med.namn }}</label>

        <div class="timestamp">
          {% if senaste_tid %}
            {% if grÃ¤ns and grÃ¤ns > 0 %}
              {% if timmar < 1 %}
                {% set minuter = ((datetime.now() - senaste_tid).total_seconds() / 60)|round(0) %}
                Togs fÃ¶r {{ minuter }} minuter sedan
                <div class="recent-dose">Intaget nyligen</div>
              {% else %}
                {% set timmar_heltal = timmar|int %}
                {% set minuter = ((timmar - timmar_heltal) * 60)|round(0) %}
                Togs fÃ¶r {{ timmar_heltal }} timmar{% if minuter > 0 %} och {{ minuter }} minuter{% endif %} sedan
              {% endif %}

              {% if med.visa_nÃ¤sta_dos and timmar < grÃ¤ns %}
                {% set Ã¥terstÃ¥r = (grÃ¤ns - timmar)|round(1) %}
                <div class="next-dose">NÃ¤sta dos om ca {{ Ã¥terstÃ¥r }} timmar</div>
              {% endif %}
            {% else %}
              Togs senast: {{ senaste_tid.strftime("%Y-%m-%d kl. %H:%M") }}
            {% endif %}
          {% else %}
            ğŸ”´ Ej registrerat intag
          {% endif %}
        </div>
      </div>
    {% endfor %}
    <button type="submit">âœ” Skicka in</button>
  </form>
{% endblock %}
